<div class="historial-container">
  <h2>ðŸ“… Mis Reservas</h2>
  <p class="subtitle">Historial completo de tus solicitudes.</p>

  <ng-container *ngIf="loading; else loaded">
    <div class="loading-state">Cargando informaciÃ³n...</div>
  </ng-container>

  <ng-template #loaded>
    <ng-container *ngIf="reservas.length === 0; else tablaReservas">
      <div class="empty-state">
        <p>No tienes reservas registradas aÃºn.</p>
        <a href="/calendario" class="btn-ir-calendario">Ir al Calendario</a>
      </div>
    </ng-container>

    <ng-template #tablaReservas>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Horario</th>
              <th>Sala</th>
              <th>Motivo</th>
              <th>Personas</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reserva of reservas; trackBy: trackById">
              <!-- Fecha -->
              <td *ngIf="editReservaId !== reserva.id">
                {{ reserva.fecha | date : "dd/MM/yyyy" : "UTC" }}
              </td>
              <td *ngIf="editReservaId === reserva.id">
                <input type="date" [formControl]="editForm.controls['fecha']" />
              </td>

              <!-- Horario -->
              <td>
                {{ reserva.bloqueInicio.slice(0, 5) }} -
                {{ reserva.bloqueFin.slice(0, 5) }}
              </td>

              <!-- Sala -->
              <td>{{ reserva.nombreSala }}</td>

              <!-- Motivo -->
              <td *ngIf="editReservaId !== reserva.id">{{ reserva.motivo }}</td>
              <td *ngIf="editReservaId === reserva.id">
                <input
                  type="text"
                  [formControl]="editForm.controls['motivo']"
                />
              </td>

              <!-- Personas -->
              <td *ngIf="editReservaId !== reserva.id" class="text-center">
                {{ reserva.cantidadPersonas }}
              </td>
              <td *ngIf="editReservaId === reserva.id">
                <input
                  type="number"
                  min="1"
                  [formControl]="editForm.controls['cantidadPersonas']"
                />
              </td>

              <!-- Estado -->
              <td>
                <span class="badge" [ngClass]="getClassEstado(reserva.estado)">
                  {{ reserva.estado }}
                </span>
              </td>

              <!-- Acciones -->
              <td>
                <ng-container
                  *ngIf="editReservaId !== reserva.id; else accionesEdicion"
                >
                  <button (click)="iniciarEdicion(reserva)">Editar</button>
                  <button (click)="eliminarReserva(reserva.id)">
                    Eliminar
                  </button>
                </ng-container>

                <ng-template #accionesEdicion>
                  <button (click)="guardarEdicion(reserva.id)">Guardar</button>
                  <button (click)="cancelarEdicion()">Cancelar</button>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-template>
  </ng-template>
</div>
